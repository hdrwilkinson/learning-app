# Course Creation

<!--
Status: Draft
Created: 2025-12-16
Issue: #15 (Q10, Q11, Q12)
Owner: Harry
-->

> System specification for AI-powered course creation, including user input gathering, baseline assessment, and the agent-based generation pipeline.

## Related Specifications

| Spec                                                              | Relationship                                 |
| ----------------------------------------------------------------- | -------------------------------------------- |
| [Information Point Generation](./information-point-generation.md) | IPs are generated as part of course creation |
| [Question Generation](./question-generation.md)                   | Questions generated after course creation    |
| [Learning & Interaction Modes](./learning-interaction-modes.md)   | Curiosity Mode can trigger course creation   |
| [Progress Prediction](./progress-prediction.md)                   | Uses study schedule from course creation     |

## Overview

Courses are created through an AI-driven conversational flow that gathers user requirements, assesses their current knowledge level, and generates a pedagogically-sound course structure in the background.

### Core Principles

1. **AI-first generation**: Courses are fully generated by AI based on user inputs
2. **Pedagogically sound**: Sequential validation ensures logical knowledge progression
3. **Right-sized**: Course scope fits within user's time commitment
4. **Background processing**: User notified when course is ready (not waiting)

---

## Entry Points

### 1. Direct "Create Course" Button

User clicks a dedicated button to start course creation.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [+ Create Course]                                              â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  Opens course creation chat with system prompt:                 â”‚
â”‚  "What would you like to learn about?"                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. From Curiosity Mode

User exploring freely can convert their conversation into a course.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User in Curiosity Mode, exploring "machine learning"           â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  [Create Course from This Topic]                                â”‚
â”‚         â”‚                                                       â”‚
â”‚         â–¼                                                       â”‚
â”‚  Course creation chat opens with conversation context           â”‚
â”‚  AI: "I see you're interested in machine learning.              â”‚
â”‚       Let's build a course! What's your goal?"                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Both entry points funnel into the same course creation flow.

---

## Information Gathering

The AI gathers the following through conversational chat:

| #   | Information        | Method          | Required |
| --- | ------------------ | --------------- | -------- |
| 1   | **Topic**          | Conversation    | âœ… Yes   |
| 2   | **Learning Goals** | Conversation    | âœ… Yes   |
| 3   | **Current Level**  | Baseline Quiz   | âœ… Yes   |
| 4   | **Study Days**     | React Component | âœ… Yes   |
| 5   | **Time per Day**   | React Component | âœ… Yes   |

### Topic & Goals (Conversational)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI: "What would you like to learn about?"                      â”‚
â”‚                                                                 â”‚
â”‚  User: "Python for data science"                                â”‚
â”‚                                                                 â”‚
â”‚  AI: "Great choice! What's your goal with Python?               â”‚
â”‚       For example:                                              â”‚
â”‚       - Analyze datasets at work                                â”‚
â”‚       - Switch careers into data science                        â”‚
â”‚       - Build ML models                                         â”‚
â”‚       - General data literacy"                                  â”‚
â”‚                                                                 â”‚
â”‚  User: "I want to analyze sales data at my job"                 â”‚
â”‚                                                                 â”‚
â”‚  AI: "Perfect - Python for workplace data analysis!             â”‚
â”‚       Let me see what you already know..."                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Baseline Assessment Quiz

### Purpose

Establish the user's current knowledge level to:

- Determine where the course should start
- Skip content they already know (course isn't generated with it)
- Include appropriate refresher content if needed

### Skill Level Scale (1-10)

| Level | Description       | Course Starts At                              |
| ----- | ----------------- | --------------------------------------------- |
| 1-2   | Absolute beginner | Very basics, no assumptions                   |
| 3-4   | Basic familiarity | Skip fundamentals, light refresher            |
| 5-6   | Intermediate      | Skip basics, start at working concepts        |
| 7-8   | Advanced          | Deep topics, quick refresher on prerequisites |
| 9-10  | Expert            | Specialized/cutting-edge content only         |

### Quiz Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI: "Before I build your course, let me see what you          â”‚
â”‚       already know. This helps me skip stuff you've mastered." â”‚
â”‚                                                                 â”‚
â”‚  [Start Quiz]  [Skip - I'm a complete beginner]                 â”‚
â”‚                        â”‚                                        â”‚
â”‚                        â””â”€â†’ Sets level to 1, skips quiz          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Quiz Mechanics

- **5-10 questions** generated based on the topic
- **Progressive difficulty**: Questions go from easy (Level 2) to hard (Level 8+)
- **Three strikes rule**: Quiz ends after 3 wrong answers
- **Level determined**: User's level = highest level they answered correctly

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BASELINE QUIZ                                    Strikes: âœ“âœ“âœ—  â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚                                                                 â”‚
â”‚  Q4 (Level 5): What's the output of `"hello"[1:4]`?             â”‚
â”‚                                                                 â”‚
â”‚  â—‹ "hel"                                                        â”‚
â”‚  â—‹ "ell"                                                        â”‚
â”‚  â—‹ "ello"                                                       â”‚
â”‚  â—‹ "hell"                                                       â”‚
â”‚                                                                 â”‚
â”‚  [Submit Answer]                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Progress: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ Q4 of ~10                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Quiz Completion

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ Strike 3 on Question 7 (Level 6)                             â”‚
â”‚                                                                 â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚                                                                 â”‚
â”‚  AI: "Got it! You've got solid Python fundamentals.             â”‚
â”‚       I'll build your course starting from intermediate         â”‚
â”‚       concepts like data manipulation."                         â”‚
â”‚                                                                 â”‚
â”‚  Your assessed level: 5/10                                      â”‚
â”‚                                                                 â”‚
â”‚  [Continue to Schedule Setup]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Quiz Question Generation

Questions are generated on-the-fly based on the topic:

```typescript
interface BaselineQuestion {
    questionText: string;
    type: "binary" | "multiple_choice";
    difficultyLevel: 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10;
    correctAnswer: string | boolean;
    options?: string[]; // For multiple choice
}

const BASELINE_QUIZ_PROMPT = `
Generate baseline assessment questions for:
Topic: {topic}
Goal: {goal}

Generate 10 questions with progressive difficulty:
- Q1-Q2: Level 2 (absolute basics)
- Q3-Q4: Level 3-4 (beginner concepts)
- Q5-Q6: Level 5-6 (intermediate)
- Q7-Q8: Level 7-8 (advanced)
- Q9-Q10: Level 9-10 (expert)

Use multiple choice format. Each question should:
- Test a specific concept at that difficulty level
- Have 4 options with exactly one correct answer
- Be answerable in under 30 seconds
`;
```

---

## Study Schedule Components

Interactive React components embedded in the chat for schedule selection.

### Day Selector Component

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI: "Which days will you study?"                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”â”‚    â”‚
â”‚  â”‚  â”‚ Mon â”‚ â”‚ Tue â”‚ â”‚ Wed â”‚ â”‚ Thu â”‚ â”‚ Fri â”‚ â”‚ Sat â”‚ â”‚ Sun â”‚â”‚    â”‚
â”‚  â”‚  â”‚  âœ“  â”‚ â”‚  âœ“  â”‚ â”‚  âœ“  â”‚ â”‚  âœ“  â”‚ â”‚  âœ“  â”‚ â”‚     â”‚ â”‚     â”‚â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Quick select: [Weekdays] [Every day] [Weekends]        â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  [Continue]                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Time Per Day Slider Component

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI: "How long will you study each session?"                    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  5 min â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 2 hours  â”‚    â”‚
â”‚  â”‚                     â†‘                                   â”‚    â”‚
â”‚  â”‚                30 minutes                               â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Presets: [15m] [30m] [45m] [1hr] [1.5hr] [2hr]         â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  [Continue]                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Schedule Data Model

```typescript
interface StudySchedule {
    daysPerWeek: DayOfWeek[]; // ['monday', 'tuesday', ...]
    minutesPerSession: number; // 5-120

    // Derived
    sessionsPerWeek: number;
    minutesPerWeek: number;
}

type DayOfWeek =
    | "monday"
    | "tuesday"
    | "wednesday"
    | "thursday"
    | "friday"
    | "saturday"
    | "sunday";
```

---

## Course Generation Trigger

After all inputs are gathered, course generation begins in the background:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI: "Perfect! Here's what I have:                              â”‚
â”‚                                                                 â”‚
â”‚       ðŸ“š Topic: Python for data science                         â”‚
â”‚       ðŸŽ¯ Goal: Analyze sales data at work                       â”‚
â”‚       ðŸ“Š Your level: 5/10 (intermediate)                        â”‚
â”‚       ðŸ“… Schedule: Weekdays, 30 min/day                         â”‚
â”‚                                                                 â”‚
â”‚       I'll create a personalized course for you now.            â”‚
â”‚       This takes a few minutes - I'll notify you when ready!"   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ðŸ”„ Creating your course...                             â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  You'll receive:                                        â”‚    â”‚
â”‚  â”‚  â€¢ ðŸ“§ Email when ready                                  â”‚    â”‚
â”‚  â”‚  â€¢ ðŸ”” In-app notification                               â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  Feel free to explore other areas while you wait!       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  [Browse Public Courses]  [Start Curiosity Chat]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Course Generation Pipeline

### Overview

Course generation is handled by a background agent pipeline that creates content iteratively with validation at each stage.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COURSE GENERATION PIPELINE (Background)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Input: Topic, Goals, Level, Schedule                           â”‚
â”‚                                                                 â”‚
â”‚  Stage 1: MODULE OUTLINES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Stage 2: LESSON OUTLINES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Stage 3: IP OUTLINES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Stage 4: IP CONTENT (sequential) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  Stage 5: FINAL VALIDATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                                 â”‚
â”‚  Output: Complete course saved to database                      â”‚
â”‚          User notified via email + in-app                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Validation Loop (Each Stage)

Each stage follows a create â†’ validate â†’ adjust loop:

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  A. CREATE       â”‚
                    â”‚  (generate)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  B. VALIDATE                         â”‚
         â”‚  (reviews output + change log)       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                          â”‚                              â”‚
                    Issues found?                        â”‚
                     â•±         â•²                         â”‚
                   No           Yes                      â”‚
                   â•±             â•²                       â”‚
                  â–¼               â–¼                      â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
  â”‚  D. CONFIRM    â”‚   â”‚  C. ADJUST              â”‚       â”‚
  â”‚  (lock & next) â”‚   â”‚  - Make changes         â”‚â”€â”€â”€â”€â”€â”€â”€â”˜
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  - Log what & why       â”‚
                       â”‚  - Back to B            â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Change Log

Tracks all changes at each stage to prevent infinite loops:

```typescript
interface ChangeLog {
    stageId: "modules" | "lessons" | "ip_outlines" | "ip_content";
    iterations: ChangeIteration[];
    maxIterations: 5; // Safety cap
}

interface ChangeIteration {
    iteration: number;
    timestamp: Date;

    // What the validator found
    issues: {
        description: string;
        severity: "minor" | "major";
        affectedItems: string[];
    }[];

    // What was changed
    changes: {
        action: "reorder" | "merge" | "split" | "add" | "remove" | "edit";
        target: string;
        description: string;
        reason: string;
    }[];

    outcome: "approved" | "needs_more_changes";
}
```

The validator sees the full change log to avoid:

- Reverting changes that were intentionally made
- Suggesting changes that have already been tried
- Getting stuck in circular adjustments

---

## Stage 1: Module Planning

### Input

- Topic, goals, user level, IP budget

### Process

**A. Create**: Generate module titles and descriptions

```typescript
const MODULE_GENERATION_PROMPT = `
Create a course module structure for:

Topic: {topic}
Learning Goal: {goal}
User Level: {level}/10
IP Budget: {targetIPs} information points maximum

Guidelines:
1. Start at difficulty level {level} (user demonstrated this)
2. Include a brief refresher module if level > 3
3. Each module should be a cohesive unit of learning
4. Modules must build on each other sequentially
5. Allocate IPs across modules (total â‰¤ {targetIPs})

Output for each module:
- Title
- Description (2-3 sentences)
- Order (1, 2, 3...)
- Prerequisite modules (which modules must come before)
- Allocated IPs (estimated count)
`;
```

**B. Validate**: Check pedagogical soundness

```typescript
const MODULE_VALIDATOR_PROMPT = `
Review this module structure for pedagogical quality.

Original Goal: {userGoal}
Topic: {topic}
User Level: {level}/10

Proposed Modules:
{modulesWithDescriptions}

Change Log (previous iterations):
{changeLog}

Review criteria:
1. Do these modules fully cover the learning goal?
2. Is the sequence pedagogically sound? (foundations before advanced)
3. Are there any gaps in knowledge progression?
4. Is there unnecessary overlap between modules?
5. Would a level {level} learner find this progression logical?

IMPORTANT: Check change log to avoid reverting intentional changes.

If adjustments needed, specify exact changes with reasoning.
If no adjustments needed, respond: "APPROVED"
`;
```

**C. Adjust**: Make specified changes, log them

**D. Confirm**: Lock module structure, proceed to Stage 2

---

## Stage 2: Lesson Planning

### Input

- Locked module structure, course context

### Process

**A. Create**: Generate lesson titles and descriptions for ALL modules at once

```typescript
const LESSON_GENERATION_PROMPT = `
Create lessons for all modules in this course.

Course Context:
- Topic: {topic}
- Goal: {goal}
- User Level: {level}
- Session Length: {sessionMinutes} minutes

Module Structure:
{lockedModules}

Guidelines:
1. Each lesson should be completable in one {sessionMinutes}-minute session
2. Lessons within a module build on each other
3. Later modules' lessons can reference earlier modules' content
4. Allocate IPs per lesson (must sum to module's allocation)
5. Each lesson should have 3-6 IPs

Output for each lesson:
- Title
- Description
- Module it belongs to
- Order within module
- Prerequisite lessons
- Allocated IPs
- Average difficulty level
`;
```

**B. Validate**: Check lesson flow, session fit, no gaps

**C. Adjust**: Reorder, split, merge, move between modules

**D. Confirm**: Lock lesson structure, proceed to Stage 3

---

## Stage 3: IP Outline Planning

### Input

- Locked module and lesson structure

### Process

**A. Create**: Generate IP titles and types for ALL lessons

```typescript
const IP_OUTLINE_PROMPT = `
Create Information Point outlines for all lessons.

Course Structure:
{lockedModulesAndLessons}

Guidelines:
1. Each IP should be a single, atomic learning concept
2. Types: definition, concept, procedure, example
3. Order IPs so prerequisites come first
4. Difficulty should progress within lessons
5. Stay within each lesson's IP allocation

Output for each IP:
- Title (clear, specific)
- Type (definition/concept/procedure/example)
- Lesson it belongs to
- Order within lesson
- Difficulty level (1-10)
- Implied prerequisites (which earlier IPs this builds on)
`;
```

**B. Validate**: Check progression, implied prerequisites, no gaps

**C. Adjust**: Reorder, add missing bridge concepts, remove redundant

**D. Confirm**: Lock IP structure, proceed to Stage 4

---

## Stage 4: IP Content Generation

### Process

Content is generated **sequentially** - each IP has access to all previous IP content.

```typescript
async function generateIPContent(courseId: string): Promise<void> {
    const ipOutlines = await getLockedIPOutlines(courseId);
    const generatedIPs: InformationPoint[] = [];

    for (const outline of ipOutlines) {
        // A. Create
        const content = await generateSingleIP(outline, generatedIPs);

        // B. Validate
        const validation = await validateIPContent(content, generatedIPs);

        if (!validation.approved) {
            // C. Adjust (with change log)
            const adjusted = await adjustIPContent(
                content,
                validation,
                changeLog
            );
            // Back to B...
        }

        // D. Confirm
        generatedIPs.push(content);
    }
}
```

### IP Content Generation Prompt

```typescript
const IP_CONTENT_PROMPT = `
Generate content for this Information Point.

=== COURSE CONTEXT ===
Course: {courseTitle}
Goal: {courseGoal}
User Level: {userLevel}/10

=== THIS IP ===
Title: {ipTitle}
Type: {ipType}
Difficulty Level: {difficultyLevel}
Lesson: {lessonTitle}
Module: {moduleTitle}

=== ALL PREVIOUS IPs IN COURSE ===
{previousIPs.map(ip => `
[${ip.id}] ${ip.title} (${ip.type}, Level ${ip.difficultyLevel})
Summary: ${ip.contentSummary}
Prerequisites: ${ip.prerequisites}
`)}

=== GENERATE ===

1. **Content** (Markdown):
   - Clear explanation appropriate for level {difficultyLevel}
   - Reference earlier concepts by name where building on them
   - Include examples where helpful
   - Use code blocks, lists, etc. as appropriate

2. **Prerequisites** (from previous IPs list):
   - List IDs of IPs that MUST be understood before this one
   - Only direct prerequisites, not transitive

3. **Quiz Types**:
   - binary: For facts, definitions
   - multiple_choice: For concepts with distinct options
   - question_answer: For explanations, procedures
`;
```

### IP Content Validation

```typescript
const IP_CONTENT_VALIDATOR_PROMPT = `
Review this Information Point content.

IP: {ip.title}
Content:
{ip.content}

Prerequisites claimed: {ip.prerequisites}

Previous IPs:
{previousIPs.map(p => `[${p.id}] ${p.title}`)}

Change Log:
{changeLog}

Check:
1. Are all claimed prerequisites from the previous IPs list?
2. Does content actually reference/build on those prerequisites?
3. Are quiz types appropriate for this content type?
4. Is the content clear and well-structured?

If issues found, specify adjustments.
If acceptable, respond: "APPROVED"
`;
```

---

## Stage 5: Final Validation

### Checks

1. **Goal alignment**: Does the complete course cover the original learning goal?
2. **Prerequisite chains**: No orphans, no cycles
3. **Time budget**: Total IPs fit within user's schedule
4. **Completeness**: No referenced concepts left undefined

### Save & Notify

```typescript
async function finalizeAndNotify(course: Course, user: User): Promise<void> {
    // Save to database
    await saveCourse(course);

    // Calculate estimates
    const estimates = calculateCourseEstimates(course, user.schedule);

    // Send notifications
    await sendEmail(user.email, {
        subject: `Your course "${course.title}" is ready!`,
        body: `
      Your personalized course is ready to start!
      
      ðŸ“š ${course.modules.length} modules
      ðŸ“– ${course.lessons.length} lessons
      â±ï¸ Estimated ${estimates.weeks} weeks at your pace
      
      [Start Learning]
    `,
    });

    await sendInAppNotification(user.id, {
        type: "course_ready",
        courseId: course.id,
        title: course.title,
    });
}
```

---

## IP Budget Calculation

Ensures courses fit within the user's time commitment.

```typescript
interface CourseConstraints {
    minutesPerWeek: number;
    maxCourseWeeks: 16;

    avgMinutesPerIP: number; // Based on user level

    maxIPs: number;
    targetIPs: number; // 70% of max for buffer
}

function calculateIPBudget(
    schedule: StudySchedule,
    userLevel: number
): CourseConstraints {
    const minutesPerWeek =
        schedule.daysPerWeek.length * schedule.minutesPerSession;
    const totalMinutes = minutesPerWeek * 16; // Max 16 weeks

    // Higher level = slightly more time per IP (more complex content)
    const avgMinutesPerIP = 6 + userLevel * 0.4; // 6-10 min range

    const maxIPs = Math.floor(totalMinutes / avgMinutesPerIP);
    const targetIPs = Math.floor(maxIPs * 0.7);

    return {
        minutesPerWeek,
        maxCourseWeeks: 16,
        avgMinutesPerIP,
        maxIPs,
        targetIPs,
    };
}
```

### Example Budget

| Schedule        | Minutes/Week | Target IPs | Est. Duration |
| --------------- | ------------ | ---------- | ------------- |
| 5 days Ã— 30 min | 150          | ~105       | 8-10 weeks    |
| 7 days Ã— 15 min | 105          | ~75        | 8-10 weeks    |
| 3 days Ã— 60 min | 180          | ~125       | 8-10 weeks    |
| 5 days Ã— 60 min | 300          | ~210       | 8-10 weeks    |

---

## Course Data Model

> **See [Database Schema Reference](/docs/reference/database-schema)** for complete Prisma model definitions.

```typescript
// Course - static course content
interface Course {
    id: string;
    title: string;
    description: string;
    topic: string;
    imageUrl?: string;
    visibility: "PRIVATE" | "PUBLIC";
    generationStatus: "PENDING" | "GENERATING" | "COMPLETED" | "FAILED";

    // Generation metadata
    generationStartedAt?: Date;
    generationCompletedAt?: Date;
    generationLogs?: ChangeLog[]; // Full history of validation iterations

    // Structure (populated during generation)
    modules: Module[];
}

// CourseMembership - user-specific learning data
// Contains learningGoal, schedule - set during course creation
interface CourseMembership {
    userId: string;
    courseId: string;
    courseRole: "CREATOR" | "ADMIN" | "STUDENT";
    learningGoal?: string; // User's objective for this course
    schedule?: Schedule; // User's study schedule
}

interface Module {
    id: string;
    courseId: string;
    title: string;
    description: string;
    order: number;
    lessons: Lesson[];
}

interface Lesson {
    id: string;
    moduleId: string;
    title: string;
    description: string;
    order: number;
    informationPoints: InformationPoint[];
}
```

---

## Sizing Constraints

Guardrails to keep courses reasonable:

```typescript
const COURSE_CONSTRAINTS = {
    // Per lesson
    minIPsPerLesson: 2,
    maxIPsPerLesson: 7,
    targetIPsPerLesson: 4,

    // Per module
    minLessonsPerModule: 3,
    maxLessonsPerModule: 10,
    targetLessonsPerModule: 5,

    // Per course
    minModules: 1,
    maxModules: 8,

    // Time bounds
    minCourseWeeks: 1,
    maxCourseWeeks: 16,

    // Session bounds
    minSessionMinutes: 5,
    maxSessionMinutes: 120,

    // Validation
    maxValidationIterations: 5,
};
```

---

## Error Handling

### Generation Failures

```typescript
interface GenerationError {
    stage: string;
    error: string;
    recoverable: boolean;
}

async function handleGenerationError(
    courseId: string,
    error: GenerationError
): Promise<void> {
    if (error.recoverable) {
        // Retry from current stage
        await retryStage(courseId, error.stage);
    } else {
        // Mark as failed, notify user
        await markCourseFailed(courseId, error);
        await notifyGenerationFailed(courseId, error);
    }
}
```

### Max Iterations Reached

If validation loop hits max iterations (5), the system:

1. Accepts the current best-effort output
2. Logs a warning for potential manual review
3. Continues to next stage (or completes with warning flag)

---

## Future Considerations

### Deferred for Post-MVP

- **Manual course creation**: Users can manually structure courses
- **Materials upload**: AI extracts content from PDFs, videos, notes
- **Course templates**: Clone/fork existing courses
- **Collaborative creation**: Multiple users building a course together

### Potential Enhancements

- **Partial progress visibility**: "Modules created... Generating lessons..."
- **Course preview**: See structure before generation completes
- **Regeneration**: "Regenerate this module with different focus"
- **Course merging**: Combine two courses into one
